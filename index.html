<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generate URL from Multiple Inputs</title>
  <link rel="stylesheet" href="style.css">
  <script>
    // -----------------------------
    // Default value objects
    // -----------------------------
    var defaultValueOptionsNO = {
      'One-time': {
        'lowest':  ['150', '300', '500'],
        'low':     ['300', '500', '800'],
        'medium':  ['500', '800', '1000'],
        'high':    ['1000', '1500', '2000'],
        'highest': ['2000', '2500', '3000']
      },
      'Monthly': {
        'lowest':  ['150', '200', '350'],
        'low':     ['200', '350', '500'],
        'medium':  ['325', '500', '750'],
        'high':    ['500', '650', '800'],
        'highest': ['750', '900', '1000']
      },
    };

    var defaultValueOptionsSE = {
      'One-time': {
        'lowest':  ['100', '250', '500'],
        'low':     ['200', '350', '600'],
        'medium':  ['300', '500', '1000'],
        'high':    ['500', '750', '1000'],
        'highest': ['1000', '1500', '2000']
      },
      'Monthly': {
        'lowest':  ['75', '125', '200'],
        'low':     ['150', '200', '250'],
        'medium':  ['200', '350', '500'],
        'high':    ['400', '600', '800'],
        'highest': ['500', '750', '1000']
      },
    };

    var defaultValueOptionsGE = {
      'One-time': {
        'lowest':  ['10', '25', '55'],
        'low':     ['25', '55', '86'],
        'medium':  ['55', '86', '116'],
        'high':    ['86', '116', '225'],
        'highest': ['116', '225', '356']
      },
      'Monthly': {
        'lowest':  ['10', '25', '50'],
        'low':     ['10', '25', '50'],
        'medium':  ['25', '50', '76'],
        'high':    ['50', '76', '100'],
        'highest': ['76', '100', '150']
      },
    };

    var defaultValueOptionsGL = {
      'One-time': {
        'lowest':  ['15', '45', '85'],
        'low':     ['25', '50', '95'],
        'medium':  ['35', '65', '125'],
        'high':    ['55', '85', '145'],
        'highest': ['85', '145', '295']
      },
      'Monthly': {
        'lowest':  ['10', '25', '55'],
        'low':     ['20', '45', '80'],
        'medium':  ['25', '55', '85'],
        'high':    ['35', '55', '95'],
        'highest': ['45', '95', '115']
      },
    };

    // Will hold whichever set of defaults we pick based on market
    var defaultValueOptions = {};
    var tableauURL = "";



    document.addEventListener('DOMContentLoaded', function() {
      // Grab DOM elements
      var marketSelect         = document.getElementById('market');
      var frequencySelect      = document.getElementById('frequency');
      var amountGroupSelect    = document.getElementById('amountgroup');
      var defaultvalueSelect   = document.getElementById('defaultvalue');
      var preselectContainer   = document.getElementById('preselect-container');
      var preselectSelect      = document.getElementById('preselect');
      var amountGroupContainer = document.getElementById('amountGroupContainer');

      // -----------------------------
      // Update which default object we use based on selected market
      // -----------------------------
      function updateMarketDefaults() {
        var market = marketSelect.value;
        if (market === "Norway") {
          defaultValueOptions = defaultValueOptionsNO;
        } else if (market === "Germany") {
          defaultValueOptions = defaultValueOptionsGE;
        } else if (market === "Sweden") {
          defaultValueOptions = defaultValueOptionsSE;
        } else {
          defaultValueOptions = defaultValueOptionsGL;
        }
        console.log("Market changed, updated defaultValueOptions:", defaultValueOptions);
      }

      // -----------------------------
      // Update available default values (populates #defaultvalue)
      // -----------------------------
     function updateDefaultValues() {
  updateMarketDefaults();

  var amountgroup = amountGroupSelect.value;
  var frequency   = frequencySelect.value;

  // Clear existing options
  defaultvalueSelect.innerHTML = "";

  // Handle "Both" case
  if (frequency === 'Both') {
    preselectContainer.style.display = 'block';
    defaultvalueSelect.innerHTML = '<option value="">No default for Both</option>';
    return; // Skip populating values
  } else {
    preselectContainer.style.display = 'none';
  }

  // Get the correct frequency options (Monthly or One-time)
  var frequencyOptions = defaultValueOptions[frequency];

  if (frequencyOptions && frequencyOptions[amountgroup]) {
    var options = frequencyOptions[amountgroup];

    options.forEach(function (val) {
      var opt = document.createElement('option');
      opt.value = val;
      opt.text = val;
      defaultvalueSelect.add(opt);
    });
  } else {
    defaultvalueSelect.innerHTML = '<option>No options available</option>';
  }
}



  // -----------------------------
  function updateDefaultFrequency() {
    // You can remove this if you no longer use defaultfrequency globally
    console.log("Preselect changed to:", preselectSelect.value);
  }

  // -----------------------------
  // Event listeners
  // -----------------------------
  amountGroupSelect.addEventListener('change', updateDefaultValues);
  preselectSelect.addEventListener('change', updateDefaultFrequency);
  frequencySelect.addEventListener('change', updateDefaultValues);

  // Initialize on page load
  updateMarketDefaults();
  updateDefaultValues();
});


    // -----------------------------
    // Generate URL function
    // -----------------------------
    function generateURL() {
      try {
        var channel     = encodeURIComponent(document.getElementById('channel').value);
        var amountgroup = document.getElementById('amountgroup').value;
        var baseURL     = document.getElementById('url').value;
        var frequency   = document.getElementById('frequency').value;
        var campaign    = encodeURIComponent(document.getElementById('campaignid').value);
        var defaultval  = document.getElementById('defaultvalue').value;
        var preselectSelect = document.getElementById('preselect');

        // Build the amountGroup param only if user selected something
        var amountgroupurl = amountgroup ? ("amountgroup=" + amountgroup + "&") : "";

        // Map the amount group to an integer
        var amountgroupintMap = {
          lowest:  1,
          low:     2,
          medium:  3,
          high:    4,
          highest: 5
        };
        var default_value_int = amountgroupintMap[amountgroup] || 3; // default to 3 if unknown

        // Add a prefix character for monthly/one-time
        var amountgroupchar;
        if (frequency === "Monthly") {
          amountgroupchar = "m";
        } else if (frequency === "One-time") {
          amountgroupchar = "o";
        } else {
          amountgroupchar = "";
        }
        var default_value_code = amountgroupchar + default_value_int.toString();

        // Build UTM parameters
        var utm_medium = channel;
        var utm_source = encodeURIComponent(document.getElementById('utmsource').value);
        var ad_content = encodeURIComponent(document.getElementById('adcontent').value);

        // Construct the final URL
        var generatedURL = baseURL + "?"
          + "frequency=" + frequency
          + (frequency === "Both" ? "&frequencydefault=" + preselectSelect.value : "") + "&"
          + amountgroupurl
          + default_value_code + "=" + defaultval
          + "&channel="    + channel
          + "&campaignid=" + campaign
          + "&utm_source=" + utm_source
          + "&utm_medium=" + utm_medium;


        tableauURL = 'https://eu-west-1a.online.tableau.com/#/site/norwegianrefugeecouncil/views/CampaignResults/Dashboard1?utmsource=' + utm_source

        document.getElementById('generatedURL').value = generatedURL;
        console.log("Generated URL:", generatedURL);
        return false;
      } catch (error) {
        console.error("Error generating URL:", error);
        alert("Error generating URL: " + error.message);
        return false;
      }
    }

    function openTableau() {
  if (tableauURL) {
    window.open(tableauURL, '_blank');
  } else {
    alert("Please generate a URL first.");
  }
}


    // -----------------------------
    // Copy to clipboard function
    // -----------------------------
    function copyToClipboard() {
      var copyText = document.getElementById('generatedURL');
      copyText.select();
      document.execCommand('copy');

      var feedback = document.getElementById('copyFeedback');
      feedback.style.display = 'block';
      setTimeout(function() {
        feedback.style.display = 'none';
      }, 2000);
    }
  </script>
</head>
<body>
  <h2>Generate URL</h2>
  <form onsubmit="return generateURL()">
    <label for="url">URL:</label>
    <input type="text" id="url" name="url" required>

    <label for="market">Market</label>
    <select id="market" name="market" required>
      <option value="" disabled selected>Select</option>
      <option value="Norway">Norway</option>
      <option value="Germany">Germany</option>
      <option value="Sweden">Sweden</option>
      <option value="Global">Global</option>
    </select>

    <label for="frequency">Choose Donation Type:</label>
    <select id="frequency" name="frequency" required>
      <option value="" disabled selected>Select</option>
      <option value="One-time">Single Donation</option>
      <option value="Monthly">Regular Donation</option>
      <option value="Both">Both</option>
    </select>

    <div id="preselect-container" style="display: none;">
      <label for="preselect">Preselect</label>
      <select id="preselect">
        <option value="Monthly">Monthly</option>
        <option value="One-time">One-time</option>
      </select>
    </div>

    <label for="channel">Channel:</label>
    <select id="channel" name="channel" required>
      <option value="" disabled selected>Select</option>
      <option value="Newsletter">Newsletter</option>
      <option value="Facebook">Facebook</option>
      <option value="instagram">Instagram</option>
      <option value="fieldmarketing">Field Marketing</option>
      <option value="Google">Google</option>
      <option value="Bing">Bing</option>
      <option value="Email">Email</option>
      <option value="youtube">Youtube</option>
      <option value="SMS">SMS</option>
      <option value="Web">Web</option>
      <option value="Direct mail">Direct Mail</option>
      <option value="Other">Other</option>
    </select>

    <label for="campaignid">Campaign ID:</label>
    <input type="text" id="campaignid" name="campaignid">

    <label for="utmsource">UTM Source:</label>
    <input type="text" id="utmsource" name="utmsource">
    <span style="color: gray; font-size: 0.9em;"> Name of your campaign/activity</span>

    <div id="amountGroupContainer">
      <label for="amountgroup">Amount Group:</label>
      <select id="amountgroup" name="amountgroup" required>
        <option value="" disabled selected>Select</option>
        <option value="lowest">Lowest</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
        <option value="highest">Highest</option>
      </select>
    </div>

    <label for="defaultvalue">Default Value:</label>
    <select id="defaultvalue" name="defaultvalue" >
      <option value="" disabled selected>Select an amount group first</option>
    </select>

    <label for="adcontent">GA Ad Content:</label>
    <input type="hidden" id="adcontent" name="adcontent">

    <input type="submit" value="Generate URL">
  </form>

  <div id="copyFeedback" class="copy-feedback" style="display: none;">
    URL copied to clipboard!
  </div>

<div class="button-wrapper">
  <div class="button-row">
    <div class="copy-url-container">
      <button class="action-btn" onclick="copyToClipboard()">Copy URL</button>
      <textarea id="generatedURL" class="generated-url-output" rows="3" readonly></textarea>
    </div>

    <div class="view-results-container">
      <button class="action-btn" id="viewResultsBtn" onclick="openTableau()">View Results</button>
      <p class="note">Note: The results will be blank until there has been activity on the campaign - please save the link and check in later</p>
    </div>
  </div>
</div>


</body>
</html>
    