<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate URL from Multiple Inputs</title>
    <link rel="stylesheet" href="style.css">
    <script>


      // Default values in form

      var defaultValueOptions = {
            'One-time':{
                  'lowest': ['150', '300', '500'],
                  'low': ['300', '500', '800'],
                  'medium': ['500', '800', '1000'],
                  'high': ['1000', '1500', '2000'],
                  'highest': ['2000', '2500', '3000']
            },

            'Monthly': {
                  'lowest': ['150', '200', '300'],
                  'low': ['200', '300', '400'],
                  'medium': ['250', '350', '500'],
                  'high': ['500', '650', '800'],
                  'highest': ['750', '900', '1000']
            },

            'Both': 
              ['250', '350', '500']
            
          };

      var defaultfrequency = '';

      // Listening for changes in frequency
      
      document.addEventListener('DOMContentLoaded', function() {
          var amountGroupSelect = document.getElementById('amountgroup');
          var frequencySelect = document.getElementById('frequency');
          var preselectContainer = document.getElementById('preselect-container'); // Container for the Preselect field
          var preselectSelect = document.getElementById('preselect'); // Preselect dropdown



          function updateDefaultValues() {
              var amountgroup = amountGroupSelect.value;
              var frequency = frequencySelect.value;
              var defaultvalueSelect = document.getElementById('defaultvalue');
              defaultvalueSelect.innerHTML = ''; // Clear existing options

                      // Show or hide the Preselect field based on the "Both" condition
              if (frequency === 'Both') {
                 preselectContainer.style.display = 'block'; // Show Preselect dropdown
              } else {
                 preselectContainer.style.display = 'none'; // Hide Preselect dropdown
              }

              if (preselectSelect && preselectContainer.style.display !== 'none') {
                 defaultfrequency = `&frequencydefault=${preselectSelect.value}`;
              } else {
                  defaultfrequency = ''; // Reset if Preselect is hidden or not available
              }


              var frequencyOptions = defaultValueOptions[frequency];

              if (frequencyOptions) {
                  var options;
                  if (Array.isArray(frequencyOptions)) {
                      // If frequencyOptions is an array (e.g., 'Both')
                      options = frequencyOptions;
                  } else if (frequencyOptions[amountgroup]) {
                      // If frequencyOptions is an object, get options based on amountgroup
                      options = frequencyOptions[amountgroup];
                  }

                  if (options && options.length > 0) {
                      options.forEach(function(option) {
                          var opt = document.createElement('option');
                          opt.value = option;
                          opt.text = option;
                          defaultvalueSelect.add(opt);
                      });
                  } else {
                      // If no options are available
                      var opt = document.createElement('option');
                      opt.value = '';
                      opt.text = 'No options available';
                      defaultvalueSelect.add(opt);
                  }
              } else {
                  // If frequencyOptions is undefined
                  var opt = document.createElement('option');
                  opt.value = '';
                  opt.text = 'No options available';
                  defaultvalueSelect.add(opt);
              }
          }

          // Update Default Values when either Amount Group or Frequency changes
          amountGroupSelect.addEventListener('change', updateDefaultValues);

          frequencySelect.addEventListener('change', function() {
    console.log("Frequency dropdown changed to:", frequencySelect.value);
    updateDefaultValues();

    var amountGroupContainer = document.getElementById('amountGroupContainer');
    var amountGroupSelect = document.getElementById('amountgroup');

    if (frequencySelect.value === 'Both') {
        amountGroupSelect.value = ''; // Reset selection
        amountGroupSelect.removeAttribute('required'); // Remove 'required' if hidden
        amountGroupContainer.style.display = 'none'; // Hide the field
    } else {
        amountGroupSelect.setAttribute('required', true); // Ensure it's required for other frequencies
        amountGroupContainer.style.display = 'block'; // Show the field
    }
});


          // Initialize Default Values on page load
          updateDefaultValues();
      });


      function generateURL() {
        try {
          // Fetching and converting values from the form
          var channel = encodeURIComponent(document.getElementById('channel').value);
          var amountgroup = document.getElementById('amountgroup').value;
          var frequency = document.getElementById('frequency').value;
          var baseURL = document.getElementById('url').value;
          var campaign = encodeURIComponent(document.getElementById('campaignid').value);
          var defaultvalue = document.getElementById('defaultvalue').value;

          var amountgroupurl;
          if (amountgroup) {
          amountgroupurl = `amountgroup=${amountgroup}&` 
          } else 
          amountgroupurl = ""; // Removes Amount Group parameter if it doesn't have a valid value

          // Attributes a number value to the amount group
          var amountgroupintMap = {
            lowest: 1,
            low: 2,
            medium: 3,
            high: 4,
            highest: 5
          };

          var default_value_int = amountgroupintMap[amountgroup] || 3 // Defaults to medium (3)


          // Attributes a character based on the chosen frequency
          var amountgroupchar;
          if (frequency == "Monthly") {
            amountgroupchar = "m";
          } else if (frequency == "One-time") {
            amountgroupchar = "o";
          }  else {
            amountgroupchar = ""
          }

          var default_value_code = amountgroupchar.concat(default_value_int.toString());
          var default_value = document.getElementById('defaultvalue').value;
        





          //UTM parameters
          var ga_medium = channel;
          var ga_source;
          if (['SMS', 'Newsletter', 'Email'].includes(channel)) {
            ga_source = encodeURIComponent('Marketing Cloud');
          } else if (['Facebook', 'Google', 'Bing'].includes(channel)) {
            ga_source = encodeURIComponent('Advertising Studio');
          } else {
            ga_source = encodeURIComponent('Unknown');
          }
          var ad_content = encodeURIComponent(document.getElementById('adcontent').value);

          console.log("Frequency selected before generating URL:", frequency);




          var generatedURL = `${baseURL}?frequency=${frequency}${defaultfrequency}&${amountgroupurl}${default_value_code}=${default_value}&channel=${channel}&campaignid=${campaign}&utm_source=${ga_source}&utm_medium=${ga_medium}`;

          document.getElementById('generatedURL').value = generatedURL;
          console.log("Generated URL: ", generatedURL);
          return false;
        } catch (error) {
          console.error("Error generating URL: ", error);
          alert("Error generating URL: " + error.message);
          return false;
        }
      }




      function copyToClipboard() {
        var copyText = document.getElementById('generatedURL');
        copyText.select();
        document.execCommand('copy');

        var feedback = document.getElementById('copyFeedback');
        feedback.style.display = 'block';

        setTimeout(function() {
          feedback.style.display = 'none';
        }, 2000);
      }
    </script>
</head>
<body>

<h2>Generate URL</h2>

<form onsubmit="return generateURL()">
    <label for="url">URL:</label>
    <input type="text" id="url" name="url" required>

    <label for="frequency">Choose Donation Type:</label>
    <select id="frequency" name="frequency" required>
        <option value="" disabled selected>Select</option>
        <option value="One-time">Single Donation</option>
        <option value="Monthly">Regular Donation</option>
        <option value="Both">Both</option>
    </select>

    <div id="preselect-container" style="display: none;">
      <label for="preselect">Preselect</label>
      <select id="preselect">
          <option value="Monthly">Monthly</option>
          <option value="One-time">One-time</option>
      </select>
  </div>

    <label for="channel">Channel:</label>
    <select id="channel" name="channel" required>
        <option value="" disabled selected>Select</option>
        <option value="Newsletter">Newsletter</option>
        <option value="Facebook">Facebook</option>
        <option value="instagram">Instagram</option>
        <option value="fieldmarketing">Field Marketing</option>
        <option value="Google">Google</option>
        <option value="Bing">Bing</option>
        <option value="Email">Email</option>
        <option value="youtube">Youtube</option>
        <option value="SMS">SMS</option>
        <option value="Web">Web</option>
        <option value="Direct mail">Direct Mail</option>
    </select>

    <label for="campaignid">Campaign ID:</label>
    <input type="text" id="campaignid" name="campaignid" >

    <div id="amountGroupContainer">
    <label for="amountgroup">Amount Group:</label>
    <select id="amountgroup" name="amountgroup" required>
        <option value="" disabled selected>Select</option> 
        <option value="lowest">Lowest</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
        <option value="highest">Highest</option> 
    </select>
</div>


    <label for="defaultvalue">Default Value:</label>
    <select id="defaultvalue" name="defaultvalue" required>
        <option value="" disabled selected>Select an amount group first</option>
    </select>


    <label for="adcontent">GA Ad Content:</label>
    <input type="text" id="adcontent" name="adcontent">

    <input type="submit" value="Generate URL">
</form>

<div id="copyFeedback" class="copy-feedback" style="display: none;">URL copied to clipboard!</div>
<textarea id="generatedURL" class="generated-url-output" rows="3" readonly></textarea>
<button onclick="copyToClipboard()">Copy URL</button>

//update code//

</body>
</html>
